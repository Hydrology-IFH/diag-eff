
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Real case example &#8212; de 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code Reference" href="../reference/reference.html" />
    <link rel="prev" title="Proof of concept" href="01_proof_of_concept.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Real-case-example">
<h1>Real case example<a class="headerlink" href="#Real-case-example" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates the applicability of Diagnostic Efficiency to a real case example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="s1">&#39;/Users/robinschwemmle/Desktop/PhD/diagnostic_efficiency&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">PATH</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">de</span> <span class="kn">import</span> <span class="n">de</span>
<span class="kn">from</span> <span class="nn">de</span> <span class="kn">import</span> <span class="n">kge</span>
<span class="kn">from</span> <span class="nn">de</span> <span class="kn">import</span> <span class="n">nse</span>
<span class="kn">from</span> <span class="nn">de</span> <span class="kn">import</span> <span class="n">util</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Observed-streamflow-time-series-and-simulated-streamflow-time-series-from-CAMELS-dataset">
<h2>Observed streamflow time series and simulated streamflow time series from CAMELS dataset<a class="headerlink" href="#Observed-streamflow-time-series-and-simulated-streamflow-time-series-from-CAMELS-dataset" title="Permalink to this headline">¶</a></h2>
<p>We use simulated streamflow time series which have been derived from Addor et al. (2017). Streamflow time series have been simulated by the coupled Snow-17 and SAC-SMA system. For further details about the modelling procedure we refer to Newman et al. (2015). In particular, we evaluated three model runs with different parameter sets, but the same input data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import a function that deals with paths properly, regardless of OS</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">path_cam1</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/Users/robinschwemmle/Desktop/PhD/diagnostic_efficiency/examples/camels_example_data/13331500_05_model_output.txt&#39;</span><span class="p">)</span>
<span class="n">path_cam2</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/Users/robinschwemmle/Desktop/PhD/diagnostic_efficiency/examples/camels_example_data/13331500_48_model_output.txt&#39;</span><span class="p">)</span>
<span class="n">path_cam3</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/Users/robinschwemmle/Desktop/PhD/diagnostic_efficiency/examples/camels_example_data/13331500_94_model_output.txt&#39;</span><span class="p">)</span>

<span class="n">df_cam1</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_camels_obs_sim</span><span class="p">(</span><span class="n">path_cam1</span><span class="p">)</span>
<span class="n">df_cam2</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_camels_obs_sim</span><span class="p">(</span><span class="n">path_cam2</span><span class="p">)</span>
<span class="n">df_cam3</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_camels_obs_sim</span><span class="p">(</span><span class="n">path_cam3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plotting-simulated-streamflow-time-series-and-corresponding-flow-duration-curves">
<h2>Plotting simulated streamflow time series and corresponding flow duration curves<a class="headerlink" href="#Plotting-simulated-streamflow-time-series-and-corresponding-flow-duration-curves" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;48&#39;</span><span class="p">,</span> <span class="s1">&#39;94&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[mm $d^{-1}$]&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
         <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[mm $d^{-1}$]&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
         <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;Time [Years]&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;Exceedence probabilty [-]&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">util</span><span class="o">.</span><span class="n">plot_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(a; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="c1"># format the ticks</span>
<span class="n">years_10</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">years_5</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">yearsFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years_10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">yearsFmt</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">years_5</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">fdc_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(b; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="c1"># legend above plot</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">],</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>

<span class="n">util</span><span class="o">.</span><span class="n">plot_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam2</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam2</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(c; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="c1"># format the ticks</span>
<span class="n">years_10</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">years_5</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">yearsFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years_10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">yearsFmt</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">years_5</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">fdc_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(d; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

<span class="n">util</span><span class="o">.</span><span class="n">plot_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(e; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="c1"># format the ticks</span>
<span class="n">years_10</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">years_5</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">yearsFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years_10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">yearsFmt</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">years_5</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">fdc_obs_sim_ax</span><span class="p">(</span><span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">],</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">&#39;(f; set_id: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.95, 0.95, &#39;(f; set_id: 94)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_02_real_case_application_7_1.png" src="../_images/tutorials_02_real_case_application_7_1.png" />
</div>
</div>
</div>
<div class="section" id="Evaluation-of-model-performance">
<h2>Evaluation of model performance<a class="headerlink" href="#Evaluation-of-model-performance" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create dataframe for comparison of DE, KGE and NSE</span>
<span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;48&#39;</span><span class="p">,</span> <span class="s1">&#39;94&#39;</span><span class="p">]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brel_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;b_area&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_cor&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="s1">&#39;b_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;b_slope&#39;</span><span class="p">,</span>
        <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;kge&#39;</span><span class="p">,</span> <span class="s1">&#39;nse&#39;</span><span class="p">]</span>
<span class="n">df_eff_cam</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Calculation-of-DE,-KGE-and-NSE">
<h3>Calculation of DE, KGE and NSE<a class="headerlink" href="#Calculation-of-DE,-KGE-and-NSE" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># make arrays</span>
<span class="n">obs_arr</span> <span class="o">=</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">sim_arr</span> <span class="o">=</span> <span class="n">df_cam1</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># mean relative bias</span>
<span class="n">brel_mean</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_mean</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">brel_mean</span>
<span class="c1"># residual relative bias</span>
<span class="n">brel_rest</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_rest</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># area of relative remaing bias</span>
<span class="n">b_area</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_area</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_area</span>
<span class="c1"># temporal correlation</span>
<span class="n">temp_cor</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_temp_cor</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_cor</span>
<span class="c1"># diagnostic efficiency</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_de</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># direction of bias</span>
<span class="n">b_dir</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_dir</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_dir</span>
<span class="c1"># slope of bias</span>
<span class="n">b_slope</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_slope</span><span class="p">(</span><span class="n">b_area</span><span class="p">,</span> <span class="n">b_dir</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_slope</span>
<span class="c1"># convert to radians</span>
<span class="c1"># (y, x) Trigonometric inverse tangent</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">brel_mean</span><span class="p">,</span> <span class="n">b_slope</span><span class="p">)</span>

<span class="c1"># KGE beta</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_beta</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE alpha</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_alpha</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>

<span class="c1"># NSE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">nse</span><span class="o">.</span><span class="n">calc_nse</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>

<span class="c1"># make arrays</span>
<span class="n">obs_arr</span> <span class="o">=</span> <span class="n">df_cam2</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">sim_arr</span> <span class="o">=</span> <span class="n">df_cam2</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># mean relative bias</span>
<span class="n">brel_mean</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_mean</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">brel_mean</span>
<span class="c1"># residual relative bias</span>
<span class="n">brel_rest</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_rest</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># area of relative remaing bias</span>
<span class="n">b_area</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_area</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_area</span>
<span class="c1"># temporal correlation</span>
<span class="n">temp_cor</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_temp_cor</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_cor</span>
<span class="c1"># diagnostic efficiency</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_de</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># direction of bias</span>
<span class="n">b_dir</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_dir</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_dir</span>
<span class="c1"># slope of bias</span>
<span class="n">b_slope</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_slope</span><span class="p">(</span><span class="n">b_area</span><span class="p">,</span> <span class="n">b_dir</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_slope</span>
<span class="c1"># convert to radians</span>
<span class="c1"># (y, x) Trigonometric inverse tangent</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">brel_mean</span><span class="p">,</span> <span class="n">b_slope</span><span class="p">)</span>

<span class="c1"># KGE beta</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_beta</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE alpha</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_alpha</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>

<span class="c1"># NSE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">nse</span><span class="o">.</span><span class="n">calc_nse</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>

<span class="c1"># make arrays</span>
<span class="n">obs_arr</span> <span class="o">=</span> <span class="n">df_cam3</span><span class="p">[</span><span class="s1">&#39;Qobs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">sim_arr</span> <span class="o">=</span> <span class="n">df_cam3</span><span class="p">[</span><span class="s1">&#39;Qsim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># mean relative bias</span>
<span class="n">brel_mean</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_mean</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">brel_mean</span>
<span class="c1"># residual relative bias</span>
<span class="n">brel_rest</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_brel_rest</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># area of relative remaing bias</span>
<span class="n">b_area</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_area</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_area</span>
<span class="c1"># temporal correlation</span>
<span class="n">temp_cor</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_temp_cor</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_cor</span>
<span class="c1"># diagnostic efficiency</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_de</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># direction of bias</span>
<span class="n">b_dir</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_dir</span><span class="p">(</span><span class="n">brel_rest</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_dir</span>
<span class="c1"># slope of bias</span>
<span class="n">b_slope</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">calc_bias_slope</span><span class="p">(</span><span class="n">b_area</span><span class="p">,</span> <span class="n">b_dir</span><span class="p">)</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_slope</span>
<span class="c1"># convert to radians</span>
<span class="c1"># (y, x) Trigonometric inverse tangent</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">brel_mean</span><span class="p">,</span> <span class="n">b_slope</span><span class="p">)</span>

<span class="c1"># KGE beta</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_beta</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE alpha</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge_alpha</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
<span class="c1"># KGE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">kge</span><span class="o">.</span><span class="n">calc_kge</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>

<span class="c1"># NSE</span>
<span class="n">df_eff_cam</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">nse</span><span class="o">.</span><span class="n">calc_nse</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> <span class="n">sim_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Diagnostic-polar-plot">
<h2>Diagnostic polar plot<a class="headerlink" href="#Diagnostic-polar-plot" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">brel_mean_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;brel_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">b_area_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;b_area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">temp_cor_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;temp_cor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">b_dir_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;b_dir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">de_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">phi_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">b_slope_arr</span> <span class="o">=</span> <span class="n">df_eff_cam</span><span class="p">[</span><span class="s1">&#39;b_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">fig_de</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">diag_polar_plot_multi_fc</span><span class="p">(</span><span class="n">brel_mean_arr</span><span class="p">,</span> <span class="n">b_area_arr</span><span class="p">,</span>
                                       <span class="n">temp_cor_arr</span><span class="p">,</span> <span class="n">de_arr</span><span class="p">,</span> <span class="n">b_dir_arr</span><span class="p">,</span>
                                       <span class="n">phi_arr</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax_lim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_02_real_case_application_13_0.png" src="../_images/tutorials_02_real_case_application_13_0.png" />
</div>
</div>
<p>Simulations realised by parameter set with set_id 94 outperform the other parameter sets. All simulations have in common, that positive dynamic error type (i.e. high flows are underestimated and low flows are overestimated) dominates accompanied by a slight positive constant error. Timing contributes least to the error.</p>
<p>After identifying the error types and its contributions, we can infer hints on how to improve the simulations. From a process- based (perceptual) perspective, it is conceivable that high flow underestimation might be caused, for example, by too much infiltration or too little snow melt. Low flow overestimation might be caused by higher storage outflows. Since a dynamic error is closely related to the model structure and parameters, measures for improvement could start with adjusting the model
parameters (e.g. refining the calibration procedure). If necessary, a follow-up measure could be to alter the model structure (e.g. adjusting the model equations). Additionally, there is positive constant error available. Because a constant error may be linked to input data errors, this implies that adjusting the input data (e.g. precipitation correction) might amend the simulations.</p>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<p>Addor, N., Newman, A. J., Mizukami, N., and Clark, M. P.: The CAMELS data set: catchment attributes and meteorology for large-sample studies, in, version 2.0 ed., Boulder, CO: UCAR/NCAR, 2017.</p>
<p>Newman, A. J., Clark, M. P., Sampson, K., Wood, A., Hay, L. E., Bock, A., Viger, R. J., Blodgett, D., Brekke, L., Arnold, J. R., Hopson, T., and Duan, Q.: Development of a large-sample watershed-scale hydrometeorological data set for the contiguous USA: data set characteristics and assessment of regional variability in hydrologic model performance, Hydrol. Earth Syst. Sci., 19, 209-223, 10.5194/hess-19-209-2015, 2015.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">de</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=schwemro&repo=de&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_proof_of_concept.html">Proof of concept</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Real case example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Observed-streamflow-time-series-and-simulated-streamflow-time-series-from-CAMELS-dataset">Observed streamflow time series and simulated streamflow time series from CAMELS dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plotting-simulated-streamflow-time-series-and-corresponding-flow-duration-curves">Plotting simulated streamflow time series and corresponding flow duration curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Evaluation-of-model-performance">Evaluation of model performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Diagnostic-polar-plot">Diagnostic polar plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Code Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="de.pdf">Download PDF</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="01_proof_of_concept.html" title="previous chapter">Proof of concept</a></li>
      <li>Next: <a href="../reference/reference.html" title="next chapter">Code Reference</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Robin Schwemmle.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/02_real_case_application.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>